groups:
  - name: Host Stats
    rules:
      - record: os:mem:avail:bsd:pct
        expr: node_memory_free_bytes/node_memory_size_bytes
      - record: os:mem:avail:linux:pct
        expr: node_memory_MemAvailable_bytes/node_memory_MemTotal_bytes
      - record: os:swap:avail:bsd:pct
        expr: 1 - node_memory_swap_used_bytes/node_memory_swap_size_bytes
      - record: os:cpu:avail:pct
        expr: 1 - ((sum by (job,instance) (node_cpu_seconds_total{mode!="idle"}))/(sum by (job,instance) (node_cpu_seconds_total{mode="idle"})))
      - record: os:cpu:temp:bsd:avg:celsius
        expr: avg by (job,instance) (node_cpu_temperature_celsius)
      - record: os:cpu:temp:linux:avg:celsius
        expr: avg by (job,instance) (node_hwmon_temp_celsius)
      - record: os:filesystem:free:pct
        expr: node_filesystem_avail_bytes  / node_filesystem_size_bytes
  - name: OS Stat Alerts
    rules:
      - alert: Disk Space
        expr: os:filesystem:free:pct{fstype!="fdescfs",fstype!="procfs"} < 0.20
        labels:
          severity: warning
        annotations:
          summary: "Filesystem {{ $labels.instance }}--{{ $labels.device }}"
          description: "Filesystem {{ $labels.device }} mounted on {{ $labels.mountpoint }} on {{ $labels.instance }} is above 80% usage"
      - alert: CPU Usage
        expr: os:cpu:avail:pct < 0.25
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "High CPU usage on {{ $labels.instance }}"
          description: "CPU usage on {{ $labels.instance }} is above 75%"
      - alert: Node Unavailable
        expr: up < 1
        for: 3m
        labels:
          severity: warning
        annotations:
          summary: "Node {{ $labels.instance }} disappeard"
          description: "Node {{ $labels.instance }} disappeared for more than 3minutes"

