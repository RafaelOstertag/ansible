---
- name: FreeBSD | Install cfengine
  pkgng: pkg=cfengine36 state=present

- name: FreeBSD | Create CFEngine keys
  command: /usr/local/sbin/cf-key creates=/var/cfengine/ppkeys/localhost.priv

- name: FreeBSD | Copy update.cf
  copy: src=cfengine/update.cf dest=/var/cfengine/inputs/update.cf force=yes

- name: FreeBSD | Copy failsafe.cf
  copy: src=cfengine/failsafe.cf dest=/var/cfengine/inputs/failsafe.cf force=yes
  notify:
    - bootstrap FreeBSD cfengine

- name: FreeBSD | Link cf-promises
  shell: 'test -f /var/cfengine/bin/cf-promises || cp -f /usr/local/sbin/cf-promises /var/cfengine/bin/cf-promises'

- name: FreeBSD | Enable cf-execd
  lineinfile: dest=/etc/rc.conf regexp="^cf_execd_enable=" line="cf_execd_enable=\"YES\""
  
  notify:
    - restart FreeBSD cfexecd
