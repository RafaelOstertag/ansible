---

- name: EC2 Web
  hosts: ec2_web
  become: yes
  become_user: root

  tasks:
    - import_role:
        name: ec2/common/set-hostname
    - import_role:
        name: ec2/common/ssh-keys
      tags:
        - ssh
    - import_role:
        name: ec2/common/sendmail
      tags:
        - mail
        - sendmail
    - import_role:
        name: ec2/common/rsync
      tags:
        - rsync
        - backup
    - import_role:
        name: ec2/gateway/ipsec
      tags:
        - vpn
        - ipsec
        - tunnel
    - import_role:
        name: ec2/gateway/hostsfile
      tags:
        - vpn
        - ipsec
        - tunnel
    - import_role:
        name: ec2/storage/data
      tags:
        - storage
    - import_role:
        name: ec2/web/nginx
      tags:
        - nginx
        - www
    - import_role:
        name: ec2/web/deploy-user
      tags:
        - deploy-user
    - import_role:
        name: ec2/web/rsync-credentials
      tags:
        - rsync
        - backup
    - import_role:
        name: ec2/web/backup
      tags:
        - backup
    # Leave this here, so it will pick up when we change the hostname
    - import_role:
        name: common/motd
