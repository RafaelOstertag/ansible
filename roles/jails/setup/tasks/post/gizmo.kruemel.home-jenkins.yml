---

- name: Install jenkins in {{ jail_name }} jail
  pkgng:
    name: jenkins
    state: present
    chroot: "{{ jail_root_directory }}/{{ jail_name }}"

- name: Install git in {{ jail_name }} jail
  pkgng:
    name: git
    state: present
    chroot: "{{ jail_root_directory }}/{{ jail_name }}"

- name: Install Guengel CA in keystore
  java_cert:
    cert_alias: guengel.ch
    cert_path: /etc/ssl/guengel.ch.pem
    keystore_create: false
    keystore_pass: changeit
    keystore_path: "{{ jail_root_directory }}/{{ jail_name }}/usr/local/openjdk8/jre/lib/security/cacerts"
    state: present

- name: Enable jenkins in {{ jail_name }} jail
  lineinfile:
    path: "{{ jail_root_directory }}/{{ jail_name }}/etc/rc.conf"
    create: yes
    state: present
    regexp: ^jenkins_enable=.*
    line: jenkins_enable="YES"

