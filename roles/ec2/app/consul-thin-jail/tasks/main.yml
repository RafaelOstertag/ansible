---

- name: Create required directories
  file:
    state: directory
    path: "{{ thin_jail_root_directory }}/consul/opt/app/{{ directory_name }}"
    mode: 0750
    owner: "5000"
    group: "5000"
  loop:
    - var/db/consul
    - etc/consul.d
  loop_control:
    loop_var: directory_name

- name: Install unzip to support installation
  pkgng:
    name: unzip
    state: present

- name: Install consul
  unarchive:
    dest: "{{ thin_jail_root_directory }}/consul/opt/app/"
    src: "https://releases.hashicorp.com/consul/{{ consul_version }}/consul_{{ consul_version }}_freebsd_amd64.zip"
    creates: "{{ thin_jail_root_directory }}/consul/opt/app/consul"
    remote_src: yes
