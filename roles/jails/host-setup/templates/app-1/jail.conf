# Ansible managed file

mount.devfs;
mount.procfs;
mount.fdescfs;
ip4 = inherit;
ip6 = inherit;


consul {
	host.hostname = consul;
	path = {{ thin_jail_root_directory }}/consul;
      mount.fstab = {{ thin_jail_root_directory }}/thin-base/etc/fstab.jail.consul;
	exec.start = "/usr/local/bin/runapp.sh /opt/app/consul agent -data-dir=/opt/app/var/db/consul -config-dir=/opt/app/etc/consul.d -server -bootstrap-expect 1 -datacenter ec2";
      exec.stop = "kill -TERM `cat /opt/app/var/supervisor.pid`";
      exec.jail_user = app;
}

kafka {
      host.hostname = kafka;
      path = /usr/jails/kafka;
      exec.jail_user = root;
      exec.start = "/usr/local/etc/rc.d/kafka onestart";
      exec.stop = "/usr/local/etc/rc.d/kafka onestop";
}

zookeeper {
      host.hostname = zookeeper;
      path = /usr/jails/zookeeper;
      exec.jail_user = root;
      exec.start = "/usr/local/etc/rc.d/zookeeper onestart";
      exec.stop = "/usr/local/etc/rc.d/zookeeper onestop";
}

nmapservice {
      host.hostname = nmapservice;
      path = {{ thin_jail_root_directory }}/nmapservice;
      mount.fstab = {{ thin_jail_root_directory }}/thin-base/etc/fstab.jail.nmapservice;
      exec.start = "/usr/bin/env LISTEN=:40000 CONSUL=localhost:8500 LOGPATH=/opt/app/var/log /usr/local/bin/runapp.sh /opt/app/nmapservice";
      exec.stop = "kill -TERM `cat /opt/app/var/supervisor.pid`";
      exec.jail_user = app;
}

lastseenservice {
      host.hostname = lastseenservice;
      path = {{ thin_jail_root_directory }}/lastseenservice;
      mount.fstab = {{ thin_jail_root_directory }}/thin-base/etc/fstab.jail.lastseenservice;
      exec.start = "/usr/bin/env LOG_DIR=/opt/app/var/log CONSUL=localhost:8500 SERVER_PORT=40001 DATABASE_URL=jdbc:postgresql://db-1/lastseenservice DATABASE_USERNAME=lastseenservice DATABASE_PASSWORD='{{ lastseen_database_password }}' JAVA_OPTS='-Xmx512m -Dlogback.configurationFile=logback-jailconfig.xml' /usr/local/bin/runjava11app.sh /opt/app/lastseenservice.jar";
      exec.stop = "kill -TERM `cat /opt/app/var/supervisor.pid`";
      exec.jail_user = app;
}

nmapserviceproxy {
      host.hostname = nmapserviceproxy;
      path = {{ thin_jail_root_directory }}/nmapserviceproxy;
      mount.fstab = {{ thin_jail_root_directory }}/thin-base/etc/fstab.jail.nmapserviceproxy;
      exec.start = "cd /opt/app ; /usr/bin/env LOG_DIR=/opt/app/var/log SERVER_PORT=40002 JAVA_OPTS='-Dlogback.configurationFile=logback-jailconfig.xml' /usr/local/bin/runjava11app.sh /opt/app/nmapserviceproxy.jar";
      exec.stop = "kill -TERM `cat /opt/app/var/supervisor.pid`";
      exec.jail_user = app;
}

funnel-retriever {
      host.hostname = funnel-retriever;
      path = /usr/jails/funnel-retriever;
      mount.fstab = /usr/jails/thin-base/etc/fstab.jail.funnel-retriever;
      exec.start = "/usr/bin/env LOG_DIR=/opt/app/var/log SERVER_PORT=40003 KAFKA_SERVER=localhost:9092 /usr/local/bin/runjava11app.sh /opt/app/app.jar";
      exec.jail_user = app;
}

funnel-persistence {
      host.hostname = funnel-persistence;
      path = /usr/jails/funnel-persistence;
      mount.fstab = /usr/jails/thin-base/etc/fstab.jail.funnel-persistence;
      exec.start = "/usr/bin/env LOG_DIR=/opt/app/var/log SERVER_PORT=40004 MONGO_URL='{{ funnel_mongodb_url }}' KAFKA_SERVER=localhost:9092 /usr/local/bin/runjava11app.sh /opt/app/app.jar";
      exec.jail_user = app;
}

funnel-chronos {
      host.hostname = funnel-chronos;
      path = /usr/jails/funnel-chronos;
      mount.fstab = /usr/jails/thin-base/etc/fstab.jail.funnel-chronos;
      exec.start = "/usr/bin/env LOG_DIR=/opt/app/var/log SERVER_PORT=40005 MONGO_URL='{{ funnel_mongodb_url }}' KAFKA_SERVER=localhost:9092 /usr/local/bin/runjava11app.sh /opt/app/app.jar";
      exec.jail_user = app;
}

funnel-rest {
      host.hostname = funnel-rest;
      path = /usr/jails/funnel-rest;
      mount.fstab = /usr/jails/thin-base/etc/fstab.jail.funnel-rest;
      exec.start = "/usr/bin/env LOG_DIR=/opt/app/var/log SERVER_PORT=40006 MONGO_URL='{{ funnel_mongodb_url }}' KAFKA_SERVER=localhost:9092 /usr/local/bin/runjava11app.sh /opt/app/app.jar";
      exec.jail_user = app;
}

funnel-notifier {
      host.hostname = funnel-notifier;
      path = /usr/jails/funnel-notifier;
      mount.fstab = /usr/jails/thin-base/etc/fstab.jail.funnel-notifier;
      exec.start = "/usr/bin/env LOG_DIR=/opt/app/var/log SERVER_PORT=40007 KAFKA_SERVER=localhost:9092 SMTP_SERVER=localhost SMTP_RECIPIENT=rafael.ostertag@gmail.com /usr/local/bin/runjava11app.sh /opt/app/app.jar";
      exec.jail_user = app;
}
