---

- name: Guarantee tls directory
  when: cyrus_host
  file:
    path: /var/imap/tls
    state: directory
    mode: 0550
    owner: cyrus
    group: cyrus

- name: Copy cyrus public key
  when: cyrus_host
  copy:
    src: "ssl/pub/{{ ansible_fqdn }}.crt"
    dest: "/var/imap/tls/cert-{{ ansible_fqdn }}.pem"
    mode: 0644
    owner: cyrus
    group: cyrus
  notify:
    - FreeBSD restart cyrus

- name: Copy cyus private key
  when: cyrus_host
  copy:
    src: "ssl/priv/{{ ansible_fqdn }}.key"
    dest: "/var/imap/tls/{{ ansible_fqdn }}.key"
    mode: 0600
    owner: cyrus
    group: cyrus
    decrypt: true
  notify:
    - FreeBSD restart cyrus
