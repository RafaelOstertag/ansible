---

- name: Create /etc/mail/tls
  when: 'not opencsw_sendmail'
  file:
    path: /etc/mail/tls
    owner: root
    group: smmsp
    mode: 0750
    state: directory

- name: Copy SSL public key to /etc/mail/tls
  when: 'not opencsw_sendmail'
  copy:
    src: "ssl/pub/{{ ansible_fqdn }}.crt"
    dest: "/etc/mail/tls/{{ ansible_fqdn }}.cert"
    owner: root
    group: smmsp
    mode: 0644
  notify:
    - Solaris restart smtp
    - Solaris restart sendmail-client

- name: Copy SSL private key to /etc/mail/tls
  when: 'not opencsw_sendmail'
  copy:
    src: "ssl/priv/{{ ansible_fqdn }}.key"
    dest: "/etc/mail/tls/{{ ansible_fqdn }}.key"
    owner: root
    group: smmsp
    mode: 0640
    decrypt: true
  notify:
    - Solaris restart smtp
    - Solaris restart sendmail-client

