---
# Depends on jails/installation role

- name: Copy CA to {{ jail_name }}
  copy:
    src: ssl/guengel.ch.pem
    dest: "/var/www/jails/{{ jail_name }}/etc/ssl"

- name: Copy CRL to {{ jail_name }}
  copy:
    src: ssl/guengel.ch.crl
    dest: "/var/www/jails/{{ jail_name }}/etc/ssl"

- name: Copy resolv.conf to {{ jail_name }}
  template:
    src: resolv.conf
    dest: "/var/www/jails/{{ jail_name }}/etc/resolv.conf"

- name: Set timezone on {{ jail_name }}
  file:
    state: link
    force: true
    src: /usr/share/zoneinfo/Europe/Zurich
    dest: "/var/www/jails/{{ jail_name }}/etc/localtime"

- name: Use official FreeBSD repository in {{ jail_name }}
  file:
    state: absent
    dest: "/var/www/jails/{{ jail_name }}/usr/local/etc/pkg/repos"
  when: "useOfficialRepo"

- name: Setup pkg repo directory in {{ jail_name }}
  file:
    state: directory
    dest: "/var/www/jails/{{ jail_name }}/usr/local/etc/pkg/repos"
  when: "not useOfficialRepo"
 
- name: Disable standard repository in {{ jail_name }}
  copy:
    src: FreeBSD.conf
    dest: "/var/www/jails/{{ jail_name  }}/usr/local/etc/pkg/repos/FreeBSD.conf"
  when: "not useOfficialRepo"

- name: Enable guengel.ch repository in {{ jail_name }}
  copy:
    src: guengel.ch.conf
    dest: "/var/www/jails/{{ jail_name }}/usr/local/etc/pkg/repos/guengel.ch.conf"
  when: "not useOfficialRepo"
 
- name: Remove freebsd-update cronjob for {{ jail_name }}
  cron:
    name: "FreeBSD update {{ jail_name }}"
    state: absent

