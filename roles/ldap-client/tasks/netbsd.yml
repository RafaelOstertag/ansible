---
- name: NetBSD | install nss_ldap
  shell: "PKG_PATH=ftp://ftp.NetBSD.org/pub/pkgsrc/packages/NetBSD/$(uname -m)/$(uname -r)/All /usr/sbin/pkg_add nss_ldap"
  ignore_errors: True

- name: NetBSD | install pam_ldap
  shell: "PKG_PATH=ftp://ftp.NetBSD.org/pub/pkgsrc/packages/NetBSD/$(uname -m)/$(uname -r)/All /usr/sbin/pkg_add pam-ldap"
  ignore_errors: True

- name: NetBSD | create /etc/ssl
  file: path=/etc/ssl group=wheel owner=root mode=755 state=directory

- name: NetBSD | install guengel.ch.pem
  copy: backup=no src=guengel.ch.pem dest=/etc/ssl/guengel.ch.pem

- name: NetBSD | install ldap.conf
  copy: backup=no src=ldap.conf-netbsd dest=/usr/pkg/etc/ldap.conf

- name: NetBSD | install display_manager pam file
  copy: backup=no src=pam-display_manager-netbsd dest=/etc/pam.d/display_manager

- name: NetBSD | install sshd pam file
  copy: backup=no src=pam-sshd-netbsd dest=/etc/pam.d/sshd

- name: NetBSD | install system pam file
  copy: backup=no src=pam-system-netbsd dest=/etc/pam.d/system

- name: NetBSD | enable nss ldap group
  lineinfile: "dest=/etc/nsswitch.conf regexp='^group:' line='group: files ldap'"

- name: NetBSD | enable nss ldap passwd
  lineinfile: "dest=/etc/nsswitch.conf regexp='^passwd:' line='passwd: files ldap'"
