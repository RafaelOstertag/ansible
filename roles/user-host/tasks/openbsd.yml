---
- name: OpenBSD | install package
  openbsd_pkg: name={{ item }} state=present
  environment:
    PKG_PATH: "ftp://ftp.ch.openbsd.org/pub/OpenBSD/{{ ansible_kernel }}/packages/{{ ansible_machine }}/"
  with_items:
    - firefox
    - thunderbird
    - xombrero
    - xfce
    - xfwm4-themes
    - xfce4-icon-theme
    - subversion
    - rsync
    - python
    - qdbm
    - git
    - cups
    - gmake
    - login_ldap
    - wget
    - amanda-client

- name: OpenBSD | ambigous packages
  openbsd_pkg: name={{ item }} state=present
  environment:
    PKG_PATH: "ftp://ftp.ch.openbsd.org/pub/OpenBSD/{{ ansible_kernel }}/packages/{{ ansible_machine }}/"
  when: ansible_kernel == "5.5"
  with_items:
    - emacs-24.3p4-gtk3
    - mutt-1.5.22p0v0
    - gtar-1.27p0
    - w3m-0.5.3p2
    - gnupg-2.0.22p0

- name: OpenBSD | ambigous packages
  openbsd_pkg: name={{ item }} state=present
  environment:
    PKG_PATH: "ftp://ftp.ch.openbsd.org/pub/OpenBSD/{{ ansible_kernel }}/packages/{{ ansible_machine }}/"
  when: ansible_kernel == "5.4"
  with_items:
    - emacs-24.3-gtk3
    - gtar-1.26p1
    - w3m-0.5.3p2
    - mutt-1.5.21p4v0
    - gnupg-2.0.19p3
    
- name: OpenBSD | enable portmap
  lineinfile: dest=/etc/rc.conf.local regexp="^portmap_flags" line="portmap_flags=\"\""

- name: OpenBSD | enable inetd
  lineinfile: dest=/etc/rc.conf.local regexp="^inetd_flags" line="inetd_flags=\"\""
  notify:
    - Restart OpenBSD inetd

- name: OpenBSD | enable package scripts
  lineinfile: dest=/etc/rc.conf.local regexp="^pkg_scripts" line="pkg_scripts=\"cf_execd dbus_daemon avahi_daemon cupsd cups_browsed\""

- name: OpenBSD | enable amanda tcp
  lineinfile: dest=/etc/inetd.conf regexp="^amanda[\s]+stream[\s]+tcp[\s]+" line="amanda  stream  tcp     nowait  operator  /usr/local/amanda/libexec/amanda/amandad amandad -auth=bsdtcp"
  notify:
    - Restart OpenBSD inetd

- name: OpenBSD | enable amanda tcp6
  lineinfile: dest=/etc/inetd.conf regexp="^amanda[\s]+stream[\s]+tcp6[\s]+" line="amanda  stream  tcp6     nowait  operator  /usr/local/amanda/libexec/amanda/amandad amandad -auth=bsdtcp"
  notify:
    - Restart OpenBSD inetd
