---

- name: Disable logging to /dev/console for serial ttys
  lineinfile:
    path: /etc/syslog.conf
    regexp: '^\*.err;kern.warning;auth.notice;mail.crit'
    state: absent
  when: serial_tty
  notify:
    - Restart FreeBSD syslog

- name: Create syslog snippets dir
  file:
    path: "/usr/local/etc/syslog.d"
    state: directory
    mode: 0755
    owner: root
    group: wheel

- name: Copy syslog snippets
  copy:
    src: "{{ item }}"
    dest: "/usr/local/etc/syslog.d/{{ item | basename }}"
    mode: 0660
    owner: root
    group: wheel
  with_fileglob:
    - "{{ ansible_fqdn }}/syslog.d/*.conf"
  notify:
    - Restart FreeBSD syslog

- name: Create empty log files from snippet name
  file:
    path: "/var/log/{{ item | basename | regex_replace('\\..*$') }}"
    state: file
    owner: root
    group: wheel
  with_fileglob:
    - "{{ ansible_fqdn }}/syslog.d/*.conf"
  notify:
    - Restart FreeBSD syslog

- name: Create syslog snippets dir
  file:
    path: "/usr/local/etc/newsyslog.conf.d"
    state: directory
    mode: 0755
    owner: root
    group: wheel

- name: Copy newsyslog snippets
  copy:
    src: "{{ item }}"
    dest: "/usr/local/etc/newsyslog.conf.d/{{ item | basename }}"
    mode: 0600
    owner: root
    group: wheel
  with_fileglob:
    - "{{ ansible_fqdn }}/newsyslog.d/*.conf"
  
