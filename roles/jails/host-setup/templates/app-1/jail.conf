# Ansible managed file

mount.devfs;
mount.procfs;
mount.fdescfs;
ip4 = inherit;
ip6 = inherit;


consul {
	host.hostname = consul;
	path = {{ thin_jail_root_directory }}/consul;
      mount.fstab = {{ thin_jail_root_directory }}/thin-base/etc/fstab.jail.consul;
	exec.start = "/usr/local/bin/runapp.sh /opt/app/consul agent -data-dir=/opt/app/var/db/consul -config-dir=/opt/app/etc/consul.d -server -bootstrap-expect 1 -datacenter ec2";
      exec.stop = "kill -TERM `cat /opt/app/var/supervisor.pid`";
      exec.jail_user = app;
}

nmapservice {
      host.hostname = nmapservice;
      path = {{ thin_jail_root_directory }}/nmapservice;
      mount.fstab = {{ thin_jail_root_directory }}/thin-base/etc/fstab.jail.nmapservice;
      exec.start = "/usr/bin/env LISTEN=:40000 CONSUL=localhost:8500 LOGPATH=/opt/app/var/log /usr/local/bin/runapp.sh /opt/app/nmapservice";
      exec.stop = "kill -TERM `cat /opt/app/var/supervisor.pid`";
      exec.jail_user = app;
}

lastseenservice {
      host.hostname = lastseenservice;
      path = {{ thin_jail_root_directory }}/lastseenservice;
      mount.fstab = {{ thin_jail_root_directory }}/thin-base/etc/fstab.jail.lastseenservice;
      exec.start = "/usr/bin/env LOG_DIR=/opt/app/var/log SERVICE_REGISTRY=localhost:8500 HTTP_PORT=40001 DATABASE_URL=jdbc:postgresql://db-1/lastseenservice DATABASE_USERNAME=lastseenservice DATABASE_PASSWORD='{{ lastseen_database_password }}' JAVA_OPTS='-Xmx512m -Dlogback.configurationFile=logback-jailconfig.xml' /usr/local/bin/runjava8app.sh /opt/app/lastseenservice.jar";
      exec.stop = "kill -TERM `cat /opt/app/var/supervisor.pid`";
      exec.jail_user = app;
}

nmapserviceproxy {
      host.hostname = nmapserviceproxy;
      path = {{ thin_jail_root_directory }}/nmapserviceproxy;
      mount.fstab = {{ thin_jail_root_directory }}/thin-base/etc/fstab.jail.nmapserviceproxy;
      # Vert.x creates files and directories in cwd, so cd first
      exec.start = "cd /opt/app ; /usr/bin/env LOG_DIR=/opt/app/var/log HTTP_PORT=40002 JAVA_OPTS='-Dlogback.configurationFile=logback-jailconfig.xml -Dvertx.logger-delegate-factory-class-name=io.vertx.core.logging.SLF4JLogDelegateFactory' /usr/local/bin/runjava11app.sh /opt/app/nmapserviceproxy.jar";
      exec.stop = "kill -TERM `cat /opt/app/var/supervisor.pid`";
      exec.jail_user = app;
}
